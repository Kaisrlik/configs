# About Me
set from = "jan.kaisrlik@intel.com"
set realname = "Jan Kaisrlik"

# TODO: source "$(dirname $(readlink -f $0))/src.conf"
# TODO: Add conditional source
source ~/devel/configs/intel.configs/intel.mutt"

# config while using imap client like offlineimap, isync
# https://people.kernel.org/mcgrof/replacing-offlineimap-with-mbsync
# set folder = "~/mail"
# source ~/.mutt/mailboxes
# set spoolfile = "+account/INBOX"
# set record = "+account/Sent\ Items"
# set postponed = "+account/Drafts"

# GnuPG bootstrap
# source "gpg -d ~/.mutt/password.gpg |"

# create virtual mailboxes
set virtual_spoolfile=yes
set nm_default_url = "notmuch://${HOME}/mail"
virtual-mailboxes "Inbox" "notmuch://?query=tag:inbox"
virtual-mailboxes "Archive" "notmuch://?query=tag:archive"
virtual-mailboxes "Sent" "notmuch://?query=tag:sent"
virtual-mailboxes "Newsletters" "notmuch://?query=tag:news"
macro index c "<change-vfolder>?" "Change to vfolder overview"
macro index F "<vfolder-from-query>" "Search mailbox"

# Where to put the stuff
set header_cache = "~/.mutt/cache/headers"
set message_cachedir="~/.mutt/cache/bodies"
set certificate_file="~/.mutt/certificates"

# Etc
set mail_check = 30
set move = no
set imap_keepalive = 900
set sort = threads
set sort_aux = reverse-date
set editor = "nvim"
set date_format="%m/%d %H:%M"

# make address book working with mutt
macro index,pager A "<pipe-message>abook --datafile ~/.mutt/addressbook --add-email<return>" "add the sender address to abook"
set query_command = "abook --datafile ~/.mutt/addressbook --mutt-query '%s'"

set mailcap_path = ~/.mutt/mailcap

# Set parsing/view of plain/html mails
auto_view text/html
alternative_order text/plain text/html

set mime_type_query_command = "file --mime-type -b %s"
# set smtp_authenticators = 'gssapi:login'
set rfc2047_parameters = yes
set sleep_time = 0 # Pause 0 seconds for informational messages
set markers = no # Disables the `+` displayed at line wraps
set mark_old = no # Unread mail stay unread until read
set mime_forward = yes # attachments are forwarded with mail
set wait_key = no # mutt won't ask "press key to continue"
set fast_reply # skip to compose when replying
set fcc_attach # save attachments with the body
set forward_format = "Fwd: %s" # format of subject when forwarding
set forward_quote # include message in forwards
set reverse_name # reply as whomever it was to
set include # include message in replies
set mail_check=60 # to avoid lags using IMAP with some email providers (yahoo for example)

# Sidebar mappings
set sidebar_visible = yes
set sidebar_width = 20
set sidebar_short_path = yes
set sidebar_next_new_wrap = yes
set mail_check_stats
set sidebar_format = '%D%?F? [%F]?%* %?N?%N/? %?S?%S?'

bind index,pager \Ck sidebar-prev
bind index,pager \Cj sidebar-next
bind index,pager \Co sidebar-open
bind index,pager \Cp sidebar-prev-new
bind index,pager \Cn sidebar-next-new
bind index,pager B sidebar-toggle-visible

bind index,pager a noop
bind index,pager i noop
bind index,pager g noop
bind index \Cf noop
bind index,pager M noop
bind index,pager C noop

# General rebindings
bind index gg first-entry
bind index j next-entry
bind index k previous-entry
bind attach <return> view-mailcap
bind attach l view-mailcap
bind editor <space> noop
bind index G last-entry
bind index gg first-entry
bind pager,attach h exit
bind pager j next-line
bind pager k previous-line
bind pager l view-attachments
macro index,pager d "<modify-tags-then-hide>+deleted<enter><previous-line><delete-message><enter>" "Delete message"
macro index,pager u "<modify-tags-then-hide>-deleted<enter><previous-entry><undelete-message><enter>" "Undelete message"
bind index L limit
bind index h noop
bind index l display-message
bind index,query <space> tag-entry
#bind browser h goto-parent
macro browser h '<change-dir><kill-line>..<enter>' "Go to parent folder"
bind index,pager H view-raw-message
bind browser l select-entry
bind browser gg top-page
bind browser G bottom-page
bind pager gg top
bind pager G bottom
bind index,pager S sync-mailbox
bind index,pager R group-reply
bind editor <Tab> complete-query

## color scheme
# Default index colors:
color index yellow default '.*'
color index_author green default '.*'
color index_number blue default
color index_subject white default '.*'

# New mail is boldened:
color index brightyellow default "~N"
color index_author brightred black "~N"
color index_subject brightcyan black "~N"

# Tagged mail is highlighted:
color index brightyellow blue "~T"
color index_author brightred blue "~T"
color index_subject brightcyan blue "~T"

# Other colors and aesthetic settings:
mono bold bold
mono underline underline
mono error bold
mono indicator bold

color indicator bold default black
color normal default default
color error red default
color sidebar_highlight red default
color sidebar_divider brightblack black
color sidebar_flagged red black
color sidebar_new green black
color search brightmagenta default
color hdrdefault brightgreen default
color quoted cyan default
color quoted1 blue default
color quoted2 green default
color quoted3 yellow default
color quoted4 red default
color quoted5 brightred default
color signature brightgreen default
color attachment green black
color markers red default
color message white blue
color status bold white black # index status bar
color tilde blue default # pager body
color tree red default

# Regex highlighting:
color body blue red "<[Gg]>"
color body blue red "<[Bb][Gg]>"
color body brightred default "[\-\.+_a-zA-Z0-9]+@[\-\.a-zA-Z0-9]+" # Email addresses
color body brightblue default "(https?|ftp)://[\-\.,/%~_:?&=\#a-zA-Z0-9]+" # URL
color body green default "\`[^\`]*\`" # Green text between ` and `
color body brightblue default "^# \.*" # Headings as bold blue
color body brightcyan default "^## \.*" # Subheadings as bold cyan
color body brightgreen default "^### \.*" # Subsubheadings as bold green
color body yellow default "^(\t| )*(-|\\*) \.*" # List items as yellow
color body brightcyan default "[;:][-o][)/(|]" # emoticons
color body brightcyan default "[;:][)(|]" # emoticons
color body brightcyan default "[ ][*][^*]*[*][ ]?" # more emoticon?
color body brightcyan default "[ ]?[*][^*]*[*][ ]" # more emoticon?

# color scheme for header:
color header white default ".*"
color header green default "^From"
color header white default "^Subject"
color header green default "^(CC|BCC)"
color header yellow default "^date: "
color header white red "^newsgroups: "
color header red default "^reply-to: "
color header white default "^subject: "
color header green default "^to: "
color header magenta default "^x-mailer: "
color header green default "^message-id:"
color header red default "^message-id: .*pine"
color body red default "(BAD signature)"
color body green default "(Good signature)"
color body brightblack default "^gpg: Good signature .*"
color body brightyellow default "^gpg: "
color body brightyellow red "^gpg: BAD signature from.*"
mono body bold "^gpg: Good signature"
mono body bold "^gpg: BAD signature from.*"
color body yellow default "([a-z][a-z0-9+-]*://(((([a-z0-9_.!~*'();:&=+$,-]|%[0-9a-f][0-9a-f])*@)?((([a-z0-9]([a-z0-9-]*[a-z0-9])?)\\.)*([a-z]([a-z0-9-]*[a-z0-9])?)\\.?|[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+)(:[0-9]+)?)|([a-z0-9_.!~*'()$,;:@&=+-]|%[0-9a-f][0-9a-f])+)(/([a-z0-9_.!~*'():@&=+$,-]|%[0-9a-f][0-9a-f])*(;([a-z0-9_.!~*'():@&=+$,-]|%[0-9a-f][0-9a-f])*)*(/([a-z0-9_.!~*'():@&=+$,-]|%[0-9a-f][0-9a-f])*(;([a-z0-9_.!~*'():@&=+$,-]|%[0-9a-f][0-9a-f])*)*)*)?(\\?([a-z0-9_.!~*'();/?:@&=+$,-]|%[0-9a-f][0-9a-f])*)?(#([a-z0-9_.!~*'();/?:@&=+$,-]|%[0-9a-f][0-9a-f])*)?|(www|ftp)\\.(([a-z0-9]([a-z0-9-]*[a-z0-9])?)\\.)*([a-z]([a-z0-9-]*[a-z0-9])?)\\.?(:[0-9]+)?(/([-a-z0-9_.!~*'():@&=+$,]|%[0-9a-f][0-9a-f])*(;([-a-z0-9_.!~*'():@&=+$,]|%[0-9a-f][0-9a-f])*)*(/([-a-z0-9_.!~*'():@&=+$,]|%[0-9a-f][0-9a-f])*(;([-a-z0-9_.!~*'():@&=+$,]|%[0-9a-f][0-9a-f])*)*)*)?(\\?([-a-z0-9_.!~*'();/?:@&=+$,]|%[0-9a-f][0-9a-f])*)?(#([-a-z0-9_.!~*'();/?:@&=+$,]|%[0-9a-f][0-9a-f])*)?)[^].,:;!)? \t\r\n<>\"]"

#set crypt_autosign = yes
#set crypt_opportunistic_encrypt = yes
#set pgp_self_encrypt = yes
#set pgp_default_key  = 'your@gpgemailaddre.ss'

# This variable specifies private notmuch tags which should not be printed
# on screen (index, pager).
set hidden_tags = "unread,draft,flagged,passed,replied,attachment,signed,encrypted,todo"

# modify (notmuch/imap) tags
bind index,pager \` modify-labels
macro index Ma "<modify-labels>+archive -unread -inbox<enter>" "Archive message"
# modify (notmuch/imap) tag non-interactively.
bind index,pager t noop
macro index,pager tt "<modify-labels>!todo<enter>" "Toggle the 'todo' tag"
# macro index tt "<modify-labels>+archive -unread -inbox<enter>" "Archive message"
# modify labels and then hide message
# bind index,pager ??? modify-labels-then-hide

# Replace some tags with icons
tag-transforms \
	"todo"    "T" \
	"invites" "CAL"

# The formats must start with 'G' and the entire sequence is case sensitive.
tag-formats "intel"   "GI" \
	"todo"    "Gt" \
	"invites" "Gi"

set index_format="%4C %S %?X?A& ? %D  %-20.20n :%?GI?%GI& ?: %s :%g: (%c)"
# The %G formatting sequence may display all tags including tags hidden by
# hidden_tags.

# the transformed message tags, %g
color index_tags green default

# These symbols are added to the index-color feature:
# %Gx will repaint those colors
color index_tag blue default "intel"
